<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Heart Horror: Yellow Mode - Dynamic Attacks</title>
<style>
body{margin:0;background:#111;color:white;font-family:'Courier New',monospace;overflow:hidden;}
canvas{display:block;margin:auto;background:#222;}
#ui{position:absolute;top:10px;left:10px;color:white;font-size:16px;}
.bar-container{background:#333;border:1px solid #fff;width:200px;height:20px;margin-bottom:5px;}
.bar{height:100%;background:red;width:100%;transition:width 0.1s;}
#burstBar{background:cyan;width:0%;transition:width 0.1s;}
#messages{position:absolute;bottom:10px;left:10px;width:90%;font-size:18px;color:yellow;white-space:pre-line;}
#keybindsMenu{position:absolute;top:50px;left:10px;background:#222;padding:10px;display:none;border:1px solid #fff;}
#keybindsMenu input{width:40px;}
button{margin-top:5px;}
</style>
</head>
<body>
<canvas id="gameCanvas" width="800" height="600"></canvas>
<div id="ui">
  <div>HP: <span id="hpText">100</span></div>
  <div class="bar-container"><div id="hpBar" class="bar"></div></div>
  <div>Burst: <span id="burstText">Ready</span></div>
  <div class="bar-container"><div id="burstBar"></div></div>
  <div>Night: <span id="nightText">1</span></div>
  <button id="keybindButton">Change Keybinds</button>
</div>

<div id="keybindsMenu">
  <div>Up: <input id="keyUp" maxlength="1"></div>
  <div>Down: <input id="keyDown" maxlength="1"></div>
  <div>Left: <input id="keyLeft" maxlength="1"></div>
  <div>Right: <input id="keyRight" maxlength="1"></div>
  <div>Burst: <input id="keyBurst" maxlength="1"></div>
  <button id="saveKeys">Save</button>
  <button id="closeKeys">Close</button>
</div>

<div id="messages">Welcome to Heart Horror: Dynamic Attacks!</div>

<script>
const canvas=document.getElementById('gameCanvas');
const ctx=canvas.getContext('2d');
let width=canvas.width,height=canvas.height;

// ---- Player ----
let player={x:width/2,y:height-100,size:20,hp:100,speed:4,burstReady:true,burstTimer:0};
let burstActive=false,BURST_DURATION=180,BURST_COOLDOWN=300;

// ---- Keybinds ----
let keys={};
let keybinds=JSON.parse(localStorage.getItem('keybinds'))||{up:'W',down:'S',left:'A',right:'D',burst:'Q'};
document.getElementById('keyUp').value=keybinds.up;
document.getElementById('keyDown').value=keybinds.down;
document.getElementById('keyLeft').value=keybinds.left;
document.getElementById('keyRight').value=keybinds.right;
document.getElementById('keyBurst').value=keybinds.burst;

document.addEventListener('keydown',e=>keys[e.key.toUpperCase()]=true);
document.addEventListener('keyup',e=>keys[e.key.toUpperCase()]=false);

document.getElementById('keybindButton').addEventListener('click',()=>{document.getElementById('keybindsMenu').style.display='block';});
document.getElementById('closeKeys').addEventListener('click',()=>{document.getElementById('keybindsMenu').style.display='none';});
document.getElementById('saveKeys').addEventListener('click',()=>{
  keybinds.up=document.getElementById('keyUp').value.toUpperCase();
  keybinds.down=document.getElementById('keyDown').value.toUpperCase();
  keybinds.left=document.getElementById('keyLeft').value.toUpperCase();
  keybinds.right=document.getElementById('keyRight').value.toUpperCase();
  keybinds.burst=document.getElementById('keyBurst').value.toUpperCase();
  localStorage.setItem('keybinds',JSON.stringify(keybinds));
  document.getElementById('keybindsMenu').style.display='none';
});

// ---- UI ----
let night=1;
let messages=[];
function addMessage(msg){messages.push(msg);if(messages.length>5)messages.shift();}

// ---- Attack Box ----
let attackBox={x:width/2-100,y:height-200,width:200,height:150};

// ---- Bullets ----
let bullets=[];
function spawnBullet(x,y,type,color,target){
  bullets.push({x,y,type,typePos:{angle:0,speed:0,timer:0},color,target});
  if(type=="homing"){bullets[bullets.length-1].typePos.speed=2;}
  if(type=="stop"){bullets[bullets.length-1].typePos.timer=60;bullets[bullets.length-1].typePos.speed=2;}
}

// ---- Enemies/Bosses ----
let bosses=[
  {name:"Shadow Phantom",color:"purple",size:20,speed:1.5,patterns:["down","homing","stop"],hp:20},
  {name:"Bone Horror",color:"white",size:25,speed:2,patterns:["zigzag","homing","stop"],hp:25},
  {name:"Creeper Face",color:"green",size:30,speed:1.2,patterns:["circle","homing","stop"],hp:30},
  {name:"Radiant Horror",color:"gold",size:50,speed:2.5,patterns:["radiance","homing","stop"],hp:100} // final boss
];
let enemies=[];
function spawnEnemies(n){
  enemies=[];
  for(let i=0;i<n;i++){
    let boss=bosses[(night+i-1)%bosses.length];
    enemies.push({
      x:Math.random()*(width-40)+20,
      y:-Math.random()*300,
      size:boss.size,
      speed:boss.speed,
      color:boss.color,
      patterns:boss.patterns.slice(),
      name:boss.name,
      hp:boss.hp,
      attackCooldown:0
    });
  }
}
spawnEnemies(1);

// ---- Update ----
function update(){
  // Player movement
  if(keys[keybinds.up])player.y-=player.speed;
  if(keys[keybinds.down])player.y+=player.speed;
  if(keys[keybinds.left])player.x-=player.speed;
  if(keys[keybinds.right])player.x+=player.speed;
  player.x=Math.max(attackBox.x,Math.min(attackBox.x+attackBox.width,player.x));
  player.y=Math.max(attackBox.y,Math.min(attackBox.y+attackBox.height,player.y));

  // Burst mechanic
  if(keys[keybinds.burst] && player.burstReady){
    burstActive=true;
    player.burstReady=false;
    player.burstTimer=BURST_DURATION;
    bullets=[];
    addMessage("Burst activated!");
  }
  if(burstActive){
    player.burstTimer--;
    if(player.burstTimer<=0) burstActive=false;
  } else if(!player.burstReady){
    player.burstTimer++;
    if(player.burstTimer>=BURST_COOLDOWN){player.burstReady=true;player.burstTimer=BURST_COOLDOWN;}
  }

  // Enemy actions
  enemies.forEach(e=>{
    // Move
    e.y+=e.speed;

    // Attack spawn cooldown
    e.attackCooldown--;
    if(e.attackCooldown<=0){
      let pattern=e.patterns[Math.floor(Math.random()*e.patterns.length)];
      if(pattern=="down") spawnBullet(e.x,e.y,"down","red");
      if(pattern=="zigzag") spawnBullet(e.x,e.y,"zigzag","white");
      if(pattern=="circle"){
        for(let i=0;i<8;i++) spawnBullet(e.x,e.y,"circle","blue",{angle:i*Math.PI/4});
      }
      if(pattern=="homing") spawnBullet(e.x,e.y,"homing","cyan",{x:player.x,y:player.y});
      if(pattern=="stop") spawnBullet(e.x,e.y,"stop","magenta",{x:player.x,y:player.y});
      if(pattern=="radiance"){
        for(let i=0;i<8;i++) spawnBullet(e.x,e.y,"circle","gold",{angle:i*Math.PI/4});
      }
      e.attackCooldown=120; // cooldown between attacks
    }
  });

  // Update bullets
  bullets.forEach((b,j)=>{
    if(b.type=="down") b.y+=3;
    if(b.type=="zigzag"){b.y+=2;b.x+=Math.sin(b.y/15)*5;}
    if(b.type=="circle"){b.x+=Math.cos(b.typePos.angle)*3;b.y+=Math.sin(b.typePos.angle)*3;b.typePos.angle+=0.05;}
    if(b.type=="homing"){
      let dx=b.target.x-b.x;
      let dy=b.target.y-b.y;
      let dist=Math.sqrt(dx*dx+dy*dy);
      b.x+=dx/dist*b.typePos.speed;
      b.y+=dy/dist*b.typePos.speed;
    }
    if(b.type=="stop"){
      if(b.typePos.timer>0){b.typePos.timer--;} 
      else{
        let dx=b.target.x-b.x;
        let dy=b.target.y-b.y;
        let dist=Math.sqrt(dx*dx+dy*dy);
        b.x+=dx/dist*b.typePos.speed;
        b.y+=dy/dist*b.typePos.speed;
      }
    }

    // Collision
    if(b.x>attackBox.x && b.x<attackBox.x+attackBox.width && b.y>attackBox.y && b.y<attackBox.y+attackBox.height && !burstActive){
      player.hp-=0.5;
      bullets.splice(j,1);
      addMessage("Hit!");
    }
  });

  bullets=bullets.filter(b=>b.x>0 && b.x<width && b.y>0 && b.y<height);

  // Night progression
  if(enemies.length===0){night++;spawnEnemies(1);addMessage("Night "+night+" begins...");}

  // UI update
  document.getElementById('hpText').innerText=Math.floor(player.hp);
  document.getElementById('hpBar').style.width=(player.hp/100*100)+'%';
  document.getElementById('burstText').innerText=player.burstReady?'Ready':'Charging';
  document.getElementById('burstBar').style.width=(burstActive?100:player.burstTimer/BURST_COOLDOWN*100)+'%';
  document.getElementById('nightText').innerText=night;

  if(player.hp<=0){addMessage("You were consumed...");alert("Game Over!");window.location.reload();}
}

// ---- Render ----
function render(){
  ctx.clearRect(0,0,width,height);

  // Attack box
  ctx.strokeStyle='yellow';
  ctx.lineWidth=4;
  ctx.strokeRect(attackBox.x,attackBox.y,attackBox.width,attackBox.height);

  // Player heart
  ctx.fillStyle='red';
  ctx.beginPath();
  ctx.arc(player.x,player.y,player.size,0,Math.PI*2);
  ctx.fill();
  if(burstActive){
    ctx.strokeStyle='cyan';
    ctx.lineWidth=5;
    ctx.beginPath();
    ctx.arc(player.x,player.y,player.size+10,0,Math.PI*2);
    ctx.stroke();
  }

  // Bullets
  bullets.forEach(b=>{
    ctx.fillStyle=b.color;
    ctx.beginPath();
    ctx.arc(b.x,b.y,6,0,Math.PI*2);
    ctx.fill();
  });

  // Enemies
  enemies.forEach(e=>{
    ctx.fillStyle=e.color;
    ctx.beginPath();
    ctx.arc(e.x,e.y,e.size,0,Math.PI*2);
    ctx.fill();
  });

  document.getElementById('messages').innerText=messages.join('\n');
}

// ---- Game Loop ----
function loop(){update();render();requestAnimationFrame(loop);}
loop();
</script>
</body>
</html>

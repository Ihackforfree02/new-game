<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>UNDERTALE GOLD — Intro & Soul Selection</title>
<style>
:root{
--bg:#000; --accent:#ffd166; --fg:#f7f6fb; --muted:#a9a9b6;
--panel:#0f0f16;
}
html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);font-family:ui-monospace,monospace,monospace;}
.center{display:flex;align-items:center;justify-content:center;height:100%;width:100%}
canvas{image-rendering:pixelated;background:#000;border:0;display:block;margin:0 auto;}
#gameRoot{width:960px;margin:12px auto;display:flex;flex-direction:column;align-items:center;gap:10px}
.hud{width:960px;display:flex;justify-content:space-between;align-items:center;color:var(--muted);font-size:13px}
.pill{background:var(--panel);padding:6px 10px;border-radius:8px;border:1px solid #111}
/* Title screen */
#titleScreen{position:relative;width:960px;height:720px;background:#000;overflow:hidden;border:4px solid #07070a;box-shadow:0 6px 30px rgba(0,0,0,0.6)}
.scanline {position:absolute;inset:0;pointer-events:none;background-image:linear-gradient(rgba(255,255,255,0.015) 1px, transparent 1px);background-size:100% 4px;opacity:0.6}
.titleLogo{position:absolute;top:120px;width:100%;text-align:center;font-family:monospace;font-weight:900;letter-spacing:2px;color:var(--accent);font-size:72px;text-shadow:0 6px 0 rgba(0,0,0,0.6)}
.subtitle{position:absolute;top:200px;width:100%;text-align:center;color:var(--fg);opacity:0.88;font-family:monospace;font-size:14px}
.prompt{position:absolute;bottom:80px;width:100%;text-align:center;color:var(--fg);opacity:0.95;font-family:monospace;font-size:18px}
.flicker{animation:flick 1.8s infinite}
@keyframes flick{ 0%{opacity:1} 4%{opacity:0.92} 7%{opacity:1} 20%{opacity:0.98} 28%{opacity:0.88} 100%{opacity:1} }

/* crawl */
#crawlWrap{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;pointer-events:none}
.crawlBox{width:720px;max-width:86%;padding:18px;border-radius:8px;background:linear-gradient(180deg, rgba(0,0,0,0.6), rgba(12,12,20,0.75));border:1px solid rgba(255,255,255,0.03);font-family:monospace;font-size:16px;line-height:1.45;color:var(--fg);opacity:0.98}
.crawlText{max-height:360px;overflow:hidden}
.crawlInner{transform:translateY(0);animation:crawl 16s linear forwards}
@keyframes crawl{ 0%{transform:translateY(100%)} 100%{transform:translateY(-100%)} }

/* soul selector */
#soulScreen{display:none;position:relative;width:960px;height:720px;background:linear-gradient(180deg,#07070a,#0b0b12);border:4px solid #07070a}
.soulCard{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,0.6);padding:18px;border-radius:10px;border:2px solid #111;width:740px;text-align:center}
.colorRow{display:flex;gap:12px;justify-content:center;margin-top:12px;flex-wrap:wrap}
.colorSwatch{width:44px;height:44px;border-radius:6px;border:2px solid #222;cursor:pointer;box-shadow:0 2px 8px rgba(0,0,0,0.6)}
.swatchLabel{font-size:12px;color:var(--muted);margin-top:8px}
.heartPreview{margin-top:12px}
.startBtn{margin-top:14px;padding:10px 18px;background:var(--accent);color:#111;border-radius:10px;border:2px solid #111;cursor:pointer;font-weight:700}

/* settings modal */
#settingsModal{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);display:none;background:#0c0c12;padding:14px;border-radius:10px;border:2px solid #111;color:var(--fg);z-index:40}
#settingsModal label{display:block;margin:6px 0;font-size:13px;color:var(--muted)}
#settingsModal input[type="text"]{padding:6px;border-radius:6px;border:1px solid #222;background:#0a0a0f;color:var(--fg);width:140px}

/* small helpers */
.small{font-size:12px;color:var(--muted)}
.muted{color:var(--muted)}
.centerRow{display:flex;align-items:center;justify-content:center;gap:10px}
</style>
</head>
<body>
<div id="gameRoot">
<div class="hud">
<div class="pill small">UNDERTALE GOLD — Intro (prototype)</div>
<div class="pill small">Save stored locally in browser</div>
</div>

<!-- Title Screen -->
<div id="titleScreen" aria-hidden="false">
<div class="scanline"></div>
<div class="titleLogo flicker">UNDERTALE GOLD</div>
<div class="subtitle">A fan-inspired prototype — original content</div>
<div class="prompt flicker" id="titlePrompt">Press Z or Enter to start</div>

<!-- Intro crawl overlay (hidden until started) -->
<div id="crawlWrap" style="display:none">
<div class="crawlBox">
<div style="text-align:center;font-weight:700;font-family:monospace;margin-bottom:10px">Long ago —</div>
<div class="crawlText">
<div class="crawlInner" id="crawlInner">
In a world folded between light and shadow, two things were born: curiosity and conflict.
<br><br>
For centuries, the valley slept — a place of small wonders, odd creatures, and songs that curled like smoke.
<br><br>
Then a new heart awoke, a small, beating pixel of will. It sought to learn and to choose.
<br><br>
This is the beginning of that heart's journey. What will you do when you meet what stares back?
<br><br>
(Press Z / Enter to skip)
</div>
</div>
</div>
</div>
</div>

<!-- Soul selection screen -->
<div id="soulScreen" aria-hidden="true">
<div class="soulCard">
<div style="font-family:monospace;font-weight:800;font-size:28px">Choose your SOUL</div>
<div class="small muted" style="margin-top:6px">Pick the color of your heart — this is purely visual now but will later influence some interactions.</div>

<div class="heartPreview" id="heartPreview" aria-hidden="false" style="height:84px"></div>

<div class="colorRow" id="colorRow" role="list">
<!-- color swatches inserted by JS -->
</div>

<div style="margin-top:12px" class="centerRow">
<button id="openSettingsBtn" class="small">Keybinds</button>
<button id="randomBtn" class="small">Random</button>
<button id="startGameBtn" class="startBtn">Start Game</button>
</div>

<div style="margin-top:10px" class="small muted">You can change color anytime in Settings.</div>
</div>
</div>

<!-- Settings modal -->
<div id="settingsModal" role="dialog" aria-modal="true" aria-hidden="true">
<div style="font-weight:700;margin-bottom:8px">Controls — remap keys</div>
<label>Up: <input id="kbUp" type="text" maxlength="2" /></label>
<label>Down: <input id="kbDown" type="text" maxlength="2" /></label>
<label>Left: <input id="kbLeft" type="text" maxlength="2" /></label>
<label>Right: <input id="kbRight" type="text" maxlength="2" /></label>
<label>Shoot: <input id="kbShoot" type="text" maxlength="6" /></label>
<label>Burst: <input id="kbBurst" type="text" maxlength="2" /></label>
<div style="margin-top:8px" class="centerRow">
<button id="saveKb" class="small">Save</button>
<button id="closeKb" class="small">Close</button>
</div>
</div>

</div>

<script>
/* ---------------------------
Intro + Soul selection logic
--------------------------- */

/* Simple storage helpers */
const LS_KEY = 'utg_intro_save_v1';
function loadSave(){
try{
const raw = localStorage.getItem(LS_KEY);
if(!raw) return { soulColor:'#ff2b2b', keybinds: null, seenIntro:false };
return JSON.parse(raw);
}catch(e){
return { soulColor:'#ff2b2b', keybinds:null, seenIntro:false };
}
}
function saveState(s){ try{ localStorage.setItem(LS_KEY, JSON.stringify(s)); }catch(e){} }

/* Elements */
const titleScreen = document.getElementById('titleScreen');
const titlePrompt = document.getElementById('titlePrompt');
const crawlWrap = document.getElementById('crawlWrap');
const crawlInner = document.getElementById('crawlInner');
const soulScreen = document.getElementById('soulScreen');
const heartPreview = document.getElementById('heartPreview');
const colorRow = document.getElementById('colorRow');
const settingsModal = document.getElementById('settingsModal');
const kbUp = document.getElementById('kbUp'), kbDown = document.getElementById('kbDown'), kbLeft = document.getElementById('kbLeft'), kbRight = document.getElementById('kbRight'), kbShoot = document.getElementById('kbShoot'), kbBurst = document.getElementById('kbBurst');

const startBtn = document.getElementById('startGameBtn'), randomBtn = document.getElementById('randomBtn'), openSettingsBtn = document.getElementById('openSettingsBtn');

/* Default save */
let stateObj = loadSave();

let keybinds = stateObj.keybinds || { up:'w', down:'s', left:'a', right:'d', shoot:' ', burst:'q', menu:'Enter' };

/* Colours for soul selection (pixel-accurate choices) */
const SOUL_COLORS = [
'#ff2b2b', '#ffd700', '#57ff9b', '#6cb6ff', '#ff6bcb', '#b56ee0', '#ffffff', '#ffc4a3',
'#ff9f1c', '#7affb7', '#7aa1ff', '#d9d9d9', '#ffd2ae', '#a6ffef', '#c7f0ff', '#ffa6b8'
];

/* Pixel heart drawing — uses canvas small pixel grid */
function drawPixelHeart(ctx, color, scale=3){
ctx.clearRect(0,0,120,120);
ctx.save();
ctx.scale(scale,scale);
const map = [
[0,1,1,0,0,1,1,0],
[1,1,1,1,1,1,1,1],
[1,1,1,1,1,1,1,1],
[0,1,1,1,1,1,1,0],
[0,0,1,1,1,1,0,0],
[0,0,0,1,1,0,0,0]
];
ctx.fillStyle = color;
const size=4;
for(let r=0;r<map.length;r++){
for(let c=0;c<map[r].length;c++){
if(map[r][c]) ctx.fillRect((c-4)*size + 40, (r-3)*size + 20, size, size);
}
}
ctx.restore();
}

/* Build color swatches */
function buildSwatches(){
colorRow.innerHTML = '';
SOUL_COLORS.forEach(col=>{
const div = document.createElement('div');
div.className = 'colorSwatch';
div.style.background = col;
div.setAttribute('role','button');
div.setAttribute('aria-label', 'Choose ' + col);
div.addEventListener('click', ()=>{ selectColor(col); });
colorRow.appendChild(div);
});
}

/* preview canvas */
const pv = document.createElement('canvas');
pv.width = 120; pv.height = 120; pv.style.width='120px'; pv.style.height='120px';
heartPreview.appendChild(pv);
const pvctx = pv.getContext('2d');

/* select color */
let selectedColor = stateObj.soulColor || SOUL_COLORS[0];
function selectColor(col){
selectedColor = col;
drawPixelHeart(pvctx, col, 2.0);
}

/* Random color */
function randomColor(){
selectedColor = SOUL_COLORS[Math.floor(Math.random()*SOUL_COLORS.length)];
drawPixelHeart(pvctx, selectedColor, 2.0);
}

/* Initialize UI */
buildSwatches();
selectColor(selectedColor);

/* Title logic: wait for Z/Enter */
let waitingToStart = true;
function onTitleKey(e){
const k = e.key;
if(!waitingToStart) return;
if(k === 'z' || k === 'Z' || k === 'Enter' || k === ' '){
startIntro(); // proceed to intro crawl
}
}
window.addEventListener('keydown', onTitleKey);

/* Intro crawl control */
let introPlaying = false;
function startIntro(){
if(introPlaying) return;
introPlaying = true;
waitingToStart = false;
window.removeEventListener('keydown', onTitleKey);
// hide prompt, show crawl
titlePrompt.style.display = 'none';
crawlWrap.style.display = 'flex';
// allow skipping with keys
function skipHandler(e){
if(!introPlaying) return;
if(['z','Z','Enter',' '].includes(e.key)){ endIntro(); }
}
window.addEventListener('keydown', skipHandler);
// auto end after duration
const duration = 16000; // 16s (matches CSS)
setTimeout(()=>{
if(introPlaying) endIntro();
window.removeEventListener('keydown', skipHandler);
}, duration + 300);
}

/* End intro, show soul selection */
function endIntro(){
introPlaying = false;
crawlWrap.style.display = 'none';
titleScreen.style.display = 'none';
soulScreen.style.display = 'block';
soulScreen.setAttribute('aria-hidden','false');
// show settings button and set preview color
selectColor(selectedColor);
}

/* Settings modal logic */
document.getElementById('openSettingsBtn').addEventListener('click', ()=>{ openSettings(); });
document.getElementById('openSettings').addEventListener('click', ()=>{ openSettings(); });
function openSettings(){
// fill with current keybinds
kbUp.value = keybinds.up.toUpperCase();
kbDown.value = keybinds.down.toUpperCase();
kbLeft.value = keybinds.left.toUpperCase();
kbRight.value = keybinds.right.toUpperCase();
kbShoot.value = keybinds.shoot === ' ' ? 'Space' : keybinds.shoot.toUpperCase();
kbBurst.value = keybinds.burst.toUpperCase();
settingsModal.style.display = 'block';
settingsModal.setAttribute('aria-hidden','false');
}
document.getElementById('closeKb').addEventListener('click', ()=>{ settingsModal.style.display = 'none'; settingsModal.setAttribute('aria-hidden','true'); });
document.getElementById('saveKb').addEventListener('click', ()=>{
keybinds.up = (kbUp.value || 'W').toLowerCase();
keybinds.down = (kbDown.value || 'S').toLowerCase();
keybinds.left = (kbLeft.value || 'A').toLowerCase();
keybinds.right = (kbRight.value || 'D').toLowerCase();
const sh = kbShoot.value; keybinds.shoot = (sh === 'Space' || sh === '') ? ' ' : sh.toLowerCase();
keybinds.burst = (kbBurst.value || 'Q').toLowerCase();
// store
stateObj.keybinds = keybinds;
saveState(stateObj);
settingsModal.style.display = 'none';
settingsModal.setAttribute('aria-hidden','true');
alert('Keybinds saved locally.');
});

/* Random and Start */
randomBtn.addEventListener('click', ()=>{ randomColor(); });
startBtn.addEventListener('click', ()=>{
// persist color selection
stateObj.soulColor = selectedColor;
stateObj.seenIntro = true;
stateObj.keybinds = keybinds;
saveState(stateObj);
// call the hook to start the main game
startGame();
});

/* Hook: replace or extend this with the main game code later.
For now it shows a small transition placeholder screen and logs save.
*/
function startGame(){
// Fade-out effect from soulScreen to a simple "Game started" canvas.
soulScreen.style.display = 'none';

// small transition canvas
const root = document.getElementById('gameRoot');
const trans = document.createElement('div');
trans.style.width='960px';
trans.style.height='720px';
trans.style.background = '#05050b';
trans.style.border = '4px solid #07070a';
trans.style.display='flex';
trans.style.alignItems='center';
trans.style.justifyContent='center';
trans.style.flexDirection='column';
root.appendChild(trans);

const msg = document.createElement('div');
msg.style.fontFamily='monospace';
msg.style.fontSize='22px';
msg.style.color='var(--fg)';
msg.style.textAlign='center';
msg.textContent = 'Preparing Undertale Gold...';
trans.appendChild(msg);

const sub = document.createElement('div');
sub.style.marginTop='12px';
sub.style.color='#bdbdcf';
sub.textContent = 'Soul color saved: ' + selectedColor;
trans.appendChild(sub);

// visual pixel heart
const cnv = document.createElement('canvas');
cnv.width=120; cnv.height=120; cnv.style.marginTop='18px';
trans.appendChild(cnv);
drawPixelHeart(cnv.getContext('2d'), selectedColor, 2.0);

// Placeholder: here is where the full engine should be invoked.
// Expose a global stub so you can replace it later:
window.UG_startGame = function(){
console.log('UG_startGame called — attach full engine here.');
alert('Attach the full game engine to window.UG_startGame() to continue.');
};

// Small "Begin" button for testing that calls UG_startGame()
const goBtn = document.createElement('button');
goBtn.textContent = 'Begin (engine placeholder)';
goBtn.style.marginTop='14px';
goBtn.style.padding='8px 12px';
goBtn.style.borderRadius='8px';
goBtn.style.border='2px solid #111';
goBtn.style.background='#ffd166';
goBtn.onclick = ()=>{ if(window.UG_startGame) window.UG_startGame(); };
trans.appendChild(goBtn);

console.log('Intro complete. Save state:', stateObj);
}

/* Draw heart in preview initially */
drawPixelHeart(pvctx, selectedColor, 2.0);

/* Accessibility: clicking the title area starts too */
document.getElementById('titleScreen').addEventListener('click', ()=>{ if(waitingToStart) startIntro(); });

/* Minor cosmetic: animate title prompt blink */
setInterval(()=>{ titlePrompt.style.visibility = (titlePrompt.style.visibility === 'hidden') ? 'visible' : 'hidden'; }, 700);

</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>UNDERTALE YELLOW â€” Trial of the Golden Lord</title>
<style>
:root{--fg:#ffd166;--hp:#ff6b6b;--ui:#0b0b0b;--line:#262626;--emerald:#7affb7;}
html,body{margin:0;height:100%;background:#000;color:var(--fg);font-family:ui-monospace,monospace;overflow:hidden;}
#stage{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);}
#wrap{position:relative;width:960px;height:720px;}
canvas{display:block;width:960px;height:720px;background:#070606;border:4px solid #0a0a0f;}
#bossHUD,#playerHUD{position:absolute;display:flex;flex-direction:column;gap:6px;}
#bossHUD{left:20px;top:22px;}
#playerHUD{right:20px;top:22px;align-items:flex-end;}
#bossHP,#pHP{height:10px;background:#141414;border:1px solid #383838;position:relative;}
#bossHPFill{background:var(--hp);position:absolute;inset:0 0 0 auto;width:100%;}
#pHPFill{background:var(--emerald);position:absolute;inset:0 0 0 auto;width:100%;}
#uiBar{position:absolute;left:50%;bottom:8px;transform:translateX(-50%);width:920px;height:116px;background:var(--ui);border:2px solid var(--line);display:flex;align-items:center;justify-content:space-between;padding:0 18px;}
.uiMenu{display:flex;gap:36px;}
.uiBtn{display:flex;align-items:center;gap:10px;cursor:pointer;transition:transform .06s;}
.uiBtn.sel{transform:translateY(-1px);}
.uiKey{width:20px;height:20px;border:2px solid #fff;display:flex;align-items:center;justify-content:center;font-weight:700;}
.uiLabel{font-size:20px;letter-spacing:1px;}
#bubble{position:absolute;left:50%;bottom:136px;transform:translateX(-50%);max-width:880px;min-height:84px;display:block;z-index:10;}
.bub{position:relative;background:var(--ui);border:2px solid #fff;padding:10px 14px;}
.bub::before,.bub::after{content:"";position:absolute;bottom:-12px;left:40px;width:0;height:0;border-left:8px solid transparent;border-right:8px solid transparent;}
.bub::before{border-top:12px solid #fff;transform:translateY(2px);}
.bub::after{border-top:12px solid var(--ui);}
#bubbleText{white-space:pre-line;line-height:1.45;color:var(--fg);}
</style>
</head>
<body>
<div id="stage">
  <div id="wrap">
    <div id="bossHUD">
      <div id="bossName">Golden Mantis</div>
      <div id="bossHP"><div id="bossHPFill"></div></div>
      <div id="bossHPVal">0/0</div>
    </div>
    <div id="playerHUD">
      <div id="playerNameLabel">Traveler</div>
      <div id="pHP"><div id="pHPFill"></div></div>
      <div id="pHPVal">20/20</div>
    </div>
    <canvas id="cv" width="960" height="720"></canvas>
    <div id="bubble"><div class="bub"><div id="bubbleText"></div></div></div>
    <div id="uiBar">
      <div class="uiMenu" id="uiMenu">
        <div class="uiBtn sel"><div class="uiKey">Z</div><div class="uiLabel">FIGHT</div></div>
        <div class="uiBtn"><div class="uiKey">A</div><div class="uiLabel">ACT</div></div>
        <div class="uiBtn"><div class="uiKey">I</div><div class="uiLabel">ITEM</div></div>
        <div class="uiBtn"><div class="uiKey">M</div><div class="uiLabel">MERCY</div></div>
      </div>
      <div id="uiCenter">Your turn.</div>
    </div>
  </div>
</div>

<script>
// ========== Profile ==========
const PROF='utg_profile_v1';
const DEFAULTS={name:'Traveler',heart:'#ffd166'};
let PRO={...DEFAULTS, ...JSON.parse(localStorage.getItem(PROF)||'{}')};
document.getElementById('playerNameLabel').textContent=PRO.name;

// ========== Canvas ==========
const cv=document.getElementById('cv'), ctx=cv.getContext('2d');
const ARENA={x:240,y:420,w:480,h:180};
let HEART={x:480,y:510,r:5,sp:280,i:0,hp:20,hpMax:20};
function updatePlayerHP(){document.getElementById('pHPFill').style.width=(200*HEART.hp/HEART.hpMax)+'px';document.getElementById('pHPVal').textContent=`${HEART.hp}/${HEART.hpMax}`;}
updatePlayerHP();

// ========== Input ==========
class Input{
  constructor(){this.k=new Set();this.down=new Set();
    addEventListener('keydown',e=>{this.k.add(e.key);this.down.add(e.key);});
    addEventListener('keyup',e=>{this.k.delete(e.key);});
  }
  is(k){return this.k.has(k)||this.k.has(String(k).toUpperCase());}
  consume(k){const had=this.down.has(k)||this.down.has(String(k).toUpperCase());this.down.delete(k);this.down.delete(String(k).toUpperCase());return had;}
  tick(){this.down.clear();}
}
const input=new Input();

// ========== Bubble ==========
const bubble=document.getElementById('bubble'), bubbleText=document.getElementById('bubbleText');
let lastDialog='';
function showBubble(t){lastDialog=t;bubble.style.display='block';bubbleText.textContent=t;}
function hideBubble(){bubble.style.display='none';}

// ========== Boss Data ==========
const bosses=[
  {
    key:'golden_mantis',name:'Golden Mantis',hpMax:300,hp:300,
    intro:['Three golden mantises appear!','Prepare yourself!'],
    acts:[
      {name:'Check', run:s=>({text:'The mantises are fast and elegant.',sparePlus:8})},
      {name:'Bow', run:s=>({text:'You bow. They respect you slightly.',sparePlus:12})}
    ],
    attacks:[
      {name:'Spear Swipe',dur:4,speed:360},
      {name:'Spin Slash',dur:5,speed:280}
    ],
    draw:function(ctx,t){
      const x=480, y=200;
      ctx.fillStyle='#ffd166';ctx.fillRect(x-20,y-40,40,40);
      ctx.fillStyle='#fff';ctx.fillRect(x-5,y-5,10,10);
    }
  },
  {
    key:'radiance',name:'The Radiance',hpMax:800,hp:800,
    intro:['A brilliant light blinds you.','The final trial begins.'],
    acts:[
      {name:'Check', run:s=>({text:'Its light burns yet mesmerizes.',sparePlus:20})},
      {name:'Bow', run:s=>({text:'You bow. It acknowledges your courage.',sparePlus:50})}
    ],
    attacks:[
      {name:'Light Beam',dur:5,speed:400},
      {name:'Golden Orbs',dur:6,speed:360}
    ],
    draw:function(ctx,t){
      ctx.fillStyle='#ffd700';ctx.beginPath();ctx.arc(480,200,30+Math.sin(t*3)*6,0,Math.PI*2);ctx.fill();
    }
  }
];

// ========== Battle ==========
let currentBoss=bosses[0], attackIndex=0, turn='player', menu='root', bullets=[], phaseT=0, showArena=false, slashes=[];
const bossHPFill=document.getElementById('bossHPFill'), bossHPVal=document.getElementById('bossHPVal'), bossNameEl=document.getElementById('bossName');
function setBoss(b){currentBoss=b;currentBoss.hp=currentBoss.hpMax;updateBossBar();}
function updateBossBar(){bossHPFill.style.width=(360*currentBoss.hp/currentBoss.hpMax)+'px';bossHPVal.textContent=`${currentBoss.hp}/${currentBoss.hpMax}`;bossNameEl.textContent=currentBoss.name;}
setBoss(currentBoss);
showBubble(currentBoss.intro.join('\n'));

// ========== Render ==========
function drawHeart(ctx,x,y){ctx.fillStyle=PRO.heart;ctx.fillRect(x-HEART.r,y-HEART.r,HEART.r*2,HEART.r*2);}
function loop(){ctx.clearRect(0,0,960,720);
  currentBoss.draw(ctx,performance.now()/500);
  drawHeart(ctx,HEART.x,HEART.y);
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Undertale Hollow Knight Battle</title>
<style>
:root{--fg:#ffd166;--hp:#ff6b6b;--emerald:#7affb7;--ui:#0b0b0b;}
html,body{margin:0;padding:0;width:100%;height:100%;background:#000;overflow:hidden;font-family:monospace;}
#stage{position:fixed;left:50%;top:50%;transform-origin:top left;}
#wrap{position:relative;width:960px;height:720px;}
canvas{display:block;width:960px;height:720px;background:#070606;border:4px solid #0a0a0f;}
#bossHUD,#playerHUD{position:absolute;display:flex;flex-direction:column;gap:6px;font-size:12px;}
#bossHUD{left:20px;top:22px;}
#playerHUD{right:20px;top:22px;align-items:flex-end;}
#bossHP,#pHP{height:10px;background:#141414;border:1px solid #383838;position:relative;}
#bossHPFill{position:absolute;inset:0 0 0 auto;background:var(--hp);}
#pHPFill{position:absolute;inset:0 0 0 auto;background:var(--emerald);}
#uiBar{position:absolute;left:50%;bottom:8px;transform:translateX(-50%);width:920px;height:116px;background:var(--ui);border:2px solid #fff;display:flex;align-items:center;justify-content:space-between;padding:0 18px;}
.uiMenu{display:flex;gap:36px;}
.uiBtn{display:flex;align-items:center;gap:10px;cursor:pointer;transition:transform .06s;}
.uiBtn.sel{transform:translateY(-1px);}
.uiKey{width:20px;height:20px;border:2px solid #fff;display:flex;align-items:center;justify-content:center;font-weight:700;}
.uiLabel{font-size:20px;letter-spacing:1px;}
#box{position:absolute;left:240px;top:420px;width:480px;height:180px;border:3px solid #fff;display:none;}
#bubble{position:absolute;left:50%;bottom:136px;transform:translateX(-50%);max-width:880px;min-height:84px;display:block;z-index:10;}
.bub{position:relative;background:var(--ui);border:2px solid #fff;padding:10px 14px;}
.bub::before,.bub::after{content:"";position:absolute;bottom:-12px;left:40px;width:0;height:0;border-left:8px solid transparent;border-right:8px solid transparent;}
.bub::before{border-top:12px solid #fff;transform:translateY(2px);}
.bub::after{border-top:12px solid var(--ui);}
#bubbleText{white-space:pre-line;line-height:1.45;color:var(--fg);}
</style>
</head>
<body>
<div id="stage">
  <div id="wrap">
    <div id="bossHUD">
      <div id="bossName">Boss Name</div>
      <div id="bossHP"><div id="bossHPFill"></div></div>
      <div id="bossHPVal">0/0</div>
    </div>
    <div id="playerHUD">
      <div id="playerNameLabel">Traveler</div>
      <div id="pHP"><div id="pHPFill"></div></div>
      <div id="pHPVal">20/20</div>
    </div>
    <canvas id="cv" width="960" height="720"></canvas>
    <div id="box"></div>
    <div id="bubble"><div class="bub"><div id="bubbleText"></div></div></div>
    <div id="uiBar">
      <div class="uiMenu" id="uiMenu">
        <div class="uiBtn sel"><div class="uiKey">Z</div><div class="uiLabel">FIGHT</div></div>
        <div class="uiBtn"><div class="uiKey">A</div><div class="uiLabel">ACT</div></div>
        <div class="uiBtn"><div class="uiKey">I</div><div class="uiLabel">ITEM</div></div>
        <div class="uiBtn"><div class="uiKey">M</div><div class="uiLabel">MERCY</div></div>
      </div>
      <div id="uiCenter">Your turn.</div>
      <div id="uiRight"></div>
    </div>
  </div>
</div>
<script>
// ---- Player Profile ----
let PLAYER = {name:"Traveler", hp:20, hpMax:20, spd:280, color:"#ffd166"};

// ---- Canvas ----
const cv=document.getElementById("cv"), ctx=cv.getContext("2d");

// ---- Arena ----
const ARENA={x:240,y:420,w:480,h:180};
const HEART={x:ARENA.x+ARENA.w/2,y:ARENA.y+ARENA.h/2,r:4,i:0,hp:PLAYER.hp,hpMax:PLAYER.hpMax};

// ---- Boss Definition ----
const bosses = [
  {key:"golden_mantis", name:"Golden Mantis", hpMax:300, acts:[{name:"Check", run:s=>({text:"The Mantis looks sharp!"})},{name:"Bow", run:s=>({text:"You bow. The mantis inclines."})}], dialogue:["A golden mantis descends."], bg:"#1a1a2d", draw:function(ctx,t){drawGoldenMantis(ctx,t);}, attacks:[/* attacks here */]},
  {key:"hornet", name:"Hornet", hpMax:280, acts:[{name:"Check", run:s=>({text:"Hornet spins its needle."})},{name:"Taunt", run:s=>({text:"Hornet taunts you!"})}], dialogue:["Hornet appears."], bg:"#2a1a1a", draw:function(ctx,t){drawHornet(ctx,t);}, attacks:[/* attacks here */]},
  {key:"radiance", name:"The Radiance", hpMax:500, acts:[{name:"Check", run:s=>({text:"A blinding radiance."})}], dialogue:["The final battle begins."], bg:"#fff7e6", draw:function(ctx,t){drawRadiance(ctx,t);}, attacks:[/* final attacks */]},
  {key:"secret_67", name:"Secret 67", hpMax:600, acts:[{name:"Check", run:s=>({text:"A mysterious foe emerges."})}], dialogue:["You have discovered Secret 67!"], bg:"#660066", draw:function(ctx,t){drawSecret67(ctx,t);}, attacks:[/* secret attacks */]}
  // All other bosses (up to 51) can be added similarly
];

let currentBoss = bosses[0], TURN_COUNT=0, turn="player", menu="root", attackIndex=0, bullets=[], slashes=[], showArena=false;

// ---- Menu ----
const uiMenu = document.getElementById("uiMenu"), uiCenter=document.getElementById("uiCenter");

// ---- Input ----
class Input{constructor(){this.k=new Set();this.down=new Set();window.addEventListener('keydown',e=>{this.k.add(e.key);this.down.add(e.key);});window.addEventListener('keyup',e=>{this.k.delete(e.key);});}is(k){return this.k.has(k)||this.k.has(String(k).toUpperCase());}consume(k){const had=this.down.has(k)||this.down.has(String(k).toUpperCase());this.down.delete(k);this.down.delete(String(k).toUpperCase());return had;}tick(){this.down.clear();}}
const input = new Input();

// ---- Helpers ----
function clamp(v,a,b){return Math.max(a,Math.min(b,v));}
function spawn(b){b.t=0; bullets.push(b); return b;}
function drawHeart(ctx,x,y,color="#ffd166",scale=0.8){ctx.save();ctx.translate(x,y);ctx.scale(scale,scale);const m=[[0,1,1,0],[1,1,1,1],[1,1,1,1],[0,1,1,0]];ctx.fillStyle=color;const s=4;for(let r=0;r<m.length;r++) for(let c=0;c<m[r].length;c++) if(m[r][c]) ctx.fillRect((c-2)*s,(r-2)*s,s,s);ctx.restore();}
function typeText(el,str,spd=14,done){el.textContent='';let i=0;clearInterval(typeText._t);typeText._t=setInterval(()=>{el.textContent=str.slice(0,++i);if(i>=str.length){clearInterval(typeText._t);done&&done();}},spd);}
function showBubble(t){typeText(document.getElementById("bubbleText"),t);document.getElementById("bubble").style.display="block";}
function hideBubble(){document.getElementById("bubble").style.display="none";}

// ---- Boss Draw Functions ----
function drawGoldenMantis(ctx,t){ctx.fillStyle="#b8902f";ctx.fillRect(440,200,80,100);}
function drawHornet(ctx,t){ctx.fillStyle="#e60000";ctx.fillRect(450,200,60,100);}
function drawRadiance(ctx,t){ctx.fillStyle="#ffffaa";ctx.beginPath();ctx.arc(480,200,60,0,Math.PI*2);ctx.fill();}
function drawSecret67(ctx,t){ctx.fillStyle="#660066";ctx.fillRect(440,180,100,120);}

// ---- Initialize Battle ----
function setBoss(b){currentBoss=b;currentBoss.hp=currentBoss.hpMax;updateHUD();attackIndex=0;}
function updateHUD(){document.getElementById("bossHPFill").style.width=(360*Math.max(0,currentBoss.hp/currentBoss.hpMax))+"px";document.getElementById("bossHPVal").textContent=`${currentBoss.hp}/${currentBoss.hpMax}`;document.getElementById("bossName").textContent=currentBoss.name;document.getElementById("pHPFill").style.width=(200*Math.max(0,HEART.hp/HEART.hpMax))+"px";document.getElementById("pHPVal").textContent=`${HEART.hp}/${HEART.hpMax}`;}
function initBattle(){TURN_COUNT=0;turn="player";menu="root";HEART.hp=PLAYER.hp;HEART.hpMax=PLAYER.hpMax;HEART.x=ARENA.x+ARENA.w/2;HEART.y=ARENA.y+ARENA.h/2;bullets=[];slashes=[];showArena=false;setBoss(currentBoss);showBubble(currentBoss.dialogue.join("\n"));}
initBattle();

// ---- Game Loop ----
let last=performance.now();
function loop(now){const dt=Math.min(0.033,(now-last)/1000);last=now-dt;update(dt);render(dt);requestAnimationFrame(loop);} requestAnimationFrame(loop);

// ---- Update ----
function update(dt){
  input.tick();
  // Player turn input
  if(turn==="player" && menu==="root"){
    if(input.consume("ArrowLeft")){} // selection code
    if(input.consume("ArrowRight")){} // selection code
    if(input.consume("z")||input.consume("Z")||input.consume("Enter")){ /* choose action */ }
  }
  if(turn==="enemy"){
    // move heart with keys
    let dx=0,dy=0;
    if(input.is("ArrowLeft")||input.is("a")) dx-=1;
    if(input.is("ArrowRight")||input.is("d")) dx+=1;
    if(input.is("ArrowUp")||input.is("w")) dy-=1;
    if(input.is("ArrowDown")||input.is("s")) dy+=1;
    const L=Math.hypot(dx,dy)||1;
    HEART.x=clamp(HEART.x+dx/L*HEART.spd*dt,ARENA.x+HEART.r,ARENA.x+ARENA.w-HEART.r);
    HEART.y=clamp(HEART.y+dy/L*HEART.spd*dt,ARENA.y+HEART.r,ARENA.y+ARENA.h-HEART.r);
    // bullets update
    bullets.forEach(b=>{b.t+=dt;b.x+=b.vx*dt;b.y+=b.vy*dt;});
    bullets=bullets.filter(b=>b.x>ARENA.x-100&&b.x<ARENA.x+ARENA.w+100&&b.y>ARENA.y-100&&b.y<ARENA.y+ARENA.h+140);
  }
}

// ---- Render ----
function render(dt){
  ctx.fillStyle=currentBoss.bg;ctx.fillRect(0,0,960,720);
  currentBoss.draw(ctx,0);
  if(showArena){
    ctx.strokeStyle="#fff";ctx.lineWidth=3;ctx.strokeRect(ARENA.x,ARENA.y,ARENA.w,ARENA.h);
    bullets.forEach(b=>{ctx.fillStyle=b.col||"#fff";ctx.beginPath();ctx.arc(b.x,b.y,b.r||4,0,Math.PI*2);ctx.fill();});
    drawHeart(ctx,HEART.x,HEART.y,PLAYER.color,0.8);
  }
}

// ---- UI ----
uiMenu.addEventListener("mousemove",e=>{const it=e.target.closest(".uiBtn");if(!it)return;const ix=[...uiMenu.children].indexOf(it);[...uiMenu.children].forEach((c,i)=>c.classList.toggle("sel",i===ix));});
uiMenu.addEventListener("click",()=>{/* choose action */});
</script>
</body>
</html>

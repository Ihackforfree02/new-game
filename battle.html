<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Undertale Hollow Knight Battle</title>
<style>
:root {
  --fg:#ffd166;
  --hp:#ff6b6b;
  --emerald:#7affb7;
  --ui:#0b0b0b;
}
html,body{margin:0;padding:0;width:100%;height:100%;background:#000;overflow:hidden;font-family:monospace;}
#stage{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);}
#wrap{position:relative;width:960px;height:720px;}
canvas{display:block;width:960px;height:720px;background:#070606;border:4px solid #0a0a0f;}
#bossHUD,#playerHUD{position:absolute;display:flex;flex-direction:column;gap:6px;font-size:14px;}
#bossHUD{left:20px;top:22px;color:var(--fg);}
#playerHUD{right:20px;top:22px;color:var(--emerald);align-items:flex-end;}
#bossHP,#pHP{height:12px;background:#141414;border:1px solid #383838;position:relative;width:360px;}
#pHP{width:200px;}
#bossHPFill{position:absolute;inset:0 0 0 auto;background:var(--hp);}
#pHPFill{position:absolute;inset:0 0 0 auto;background:var(--emerald);}
#uiBar{position:absolute;left:50%;bottom:8px;transform:translateX(-50%);width:920px;height:116px;background:var(--ui);border:2px solid #fff;display:flex;align-items:center;justify-content:space-between;padding:0 18px;}
.uiMenu{display:flex;gap:36px;}
.uiBtn{display:flex;align-items:center;gap:10px;cursor:pointer;transition:transform .06s;}
.uiBtn.sel{transform:translateY(-1px);}
.uiKey{width:20px;height:20px;border:2px solid #fff;display:flex;align-items:center;justify-content:center;font-weight:700;}
.uiLabel{font-size:20px;letter-spacing:1px;}
#box{position:absolute;left:240px;top:420px;width:480px;height:180px;border:3px solid #fff;display:none;}
#bubble{position:absolute;left:50%;bottom:136px;transform:translateX(-50%);max-width:880px;min-height:84px;display:block;z-index:10;}
.bub{position:relative;background:var(--ui);border:2px solid #fff;padding:10px 14px;}
.bub::before,.bub::after{content:"";position:absolute;bottom:-12px;left:40px;width:0;height:0;border-left:8px solid transparent;border-right:8px solid transparent;}
.bub::before{border-top:12px solid #fff;transform:translateY(2px);}
.bub::after{border-top:12px solid var(--ui);}
#bubbleText{white-space:pre-line;line-height:1.45;color:var(--fg);}
</style>
</head>
<body>
<div id="stage">
  <div id="wrap">
    <div id="bossHUD">
      <div id="bossName">Golden Mantis</div>
      <div id="bossHP"><div id="bossHPFill"></div></div>
      <div id="bossHPVal">300/300</div>
    </div>
    <div id="playerHUD">
      <div id="playerNameLabel">Traveler</div>
      <div id="pHP"><div id="pHPFill"></div></div>
      <div id="pHPVal">20/20</div>
    </div>
    <canvas id="cv" width="960" height="720"></canvas>
    <div id="box"></div>
    <div id="bubble"><div class="bub"><div id="bubbleText"></div></div></div>
    <div id="uiBar">
      <div class="uiMenu" id="uiMenu">
        <div class="uiBtn sel"><div class="uiKey">Z</div><div class="uiLabel">FIGHT</div></div>
        <div class="uiBtn"><div class="uiKey">A</div><div class="uiLabel">ACT</div></div>
        <div class="uiBtn"><div class="uiKey">I</div><div class="uiLabel">ITEM</div></div>
        <div class="uiBtn"><div class="uiKey">M</div><div class="uiLabel">MERCY</div></div>
      </div>
      <div id="uiCenter">Your turn.</div>
      <div id="uiRight"></div>
    </div>
  </div>
</div>

<script>
// ---- Player ----
let PLAYER = {name:"Traveler",hp:20,hpMax:20,spd:280,color:"#ffd166"};
const HEART={x:480,y:510,r:6,hp:PLAYER.hp,hpMax:PLAYER.hpMax,i:0};

// ---- Canvas ----
const cv=document.getElementById("cv"), ctx=cv.getContext("2d");

// ---- Boss ----
let currentBoss={name:"Golden Mantis",hp:300,hpMax:300,draw:drawGoldenMantis,bg:"#1a1a2d",acts:[{name:"Check",run:s=>({text:"The Mantis looks sharp!"})},{name:"Bow",run:s=>({text:"You bow. The mantis inclines."})}],dialogue:["A golden mantis descends."]};
updateHUD();

// ---- Input ----
class Input{constructor(){this.k=new Set();this.down=new Set();window.addEventListener('keydown',e=>{this.k.add(e.key);this.down.add(e.key);});window.addEventListener('keyup',e=>{this.k.delete(e.key);});}is(k){return this.k.has(k)||this.k.has(String(k).toUpperCase());}consume(k){const had=this.down.has(k)||this.down.has(String(k).toUpperCase());this.down.delete(k);this.down.delete(String(k).toUpperCase());return had;}tick(){this.down.clear();}}
const input=new Input();

// ---- HUD Update ----
function updateHUD(){
  document.getElementById("bossHPFill").style.width=(360*Math.max(0,currentBoss.hp/currentBoss.hpMax))+"px";
  document.getElementById("bossHPVal").textContent=`${currentBoss.hp}/${currentBoss.hpMax}`;
  document.getElementById("pHPFill").style.width=(200*Math.max(0,HEART.hp/HEART.hpMax))+"px";
  document.getElementById("pHPVal").textContent=`${HEART.hp}/${HEART.hpMax}`;
  document.getElementById("bossName").textContent=currentBoss.name;
}

// ---- Bubble ----
function showBubble(t){document.getElementById("bubbleText").textContent=t;document.getElementById("bubble").style.display="block";}
function hideBubble(){document.getElementById("bubble").style.display="none";}

// ---- Draw Functions ----
function drawGoldenMantis(ctx,t){
  ctx.fillStyle="#b8902f";
  ctx.fillRect(440,200,80,100); // torso
  ctx.fillRect(460,300,40,30); // legs
  ctx.fillRect(420,200,20,80); // left arm
  ctx.fillRect(520,200,20,80); // right arm
}

// ---- Heart ----
function drawHeart(ctx,x,y,color="#ffd166"){
  ctx.save();
  ctx.translate(x,y);
  ctx.fillStyle=color;
  ctx.beginPath();
  ctx.moveTo(0,5); ctx.bezierCurveTo(-5,-5, -15,5,0,15);
  ctx.bezierCurveTo(15,5,5,-5,0,5); ctx.fill();
  ctx.restore();
}

// ---- Game Loop ----
let last=performance.now();
function loop(now){
  const dt=Math.min(0.033,(now-last)/1000); last=now;
  update(dt);
  render(dt);
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

// ---- Update ----
function update(dt){
  input.tick();
  // Player movement during enemy turn
  if(input.is("ArrowLeft")) HEART.x-=PLAYER.spd*dt;
  if(input.is("ArrowRight")) HEART.x+=PLAYER.spd*dt;
  if(input.is("ArrowUp")) HEART.y-=PLAYER.spd*dt;
  if(input.is("ArrowDown")) HEART.y+=PLAYER.spd*dt;
  HEART.x=clamp(HEART.x,240,720);
  HEART.y=clamp(HEART.y,420,600);
}

// ---- Render ----
function render(dt){
  ctx.fillStyle=currentBoss.bg; ctx.fillRect(0,0,960,720);
  currentBoss.draw(ctx,0);
  drawHeart(ctx,HEART.x,HEART.y,PLAYER.color);
}

// ---- Utils ----
function clamp(v,a,b){return Math.max(a,Math.min(b,v));}
</script>
</body>
</html>

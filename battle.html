<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<title>Undertale-style compact battle</title>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<style>
html,body{margin:0;height:100%;background:#000;display:flex;align-items:center;justify-content:center;font-family:monospace}
#wrap{width:860px;height:640px;position:relative;background:#111;border:3px solid #fff}
canvas{display:block}
#hud{position:absolute;top:0;left:0;right:0;padding:8px 12px;display:flex;justify-content:space-between;color:#fff}
.bar{height:8px;background:#333;position:relative}
.fill{position:absolute;left:0;top:0;bottom:0}
#bossFill{background:#f55}#hpFill{background:#5f5}
#bubble{position:absolute;bottom:104px;left:50%;transform:translateX(-50%);background:#fff;color:#000;padding:8px 10px;border:2px solid #000;display:none;max-width:85%}
#arena{position:absolute;bottom:84px;left:190px;width:480px;height:170px;border:2px solid #fff;display:none}
#ui{position:absolute;bottom:0;left:0;right:0;height:84px;background:#222;display:flex;justify-content:space-around;align-items:center;color:#fff}
.btn{cursor:pointer}
#act{position:absolute;bottom:100px;left:50%;transform:translateX(-50%);background:#0e0f16;color:#ffd166;border:2px solid #ffd166;border-radius:6px;padding:8px;display:none;min-width:380px}
#act h3{margin:0 0 6px 0}
.opt{border:1px solid #30303f;background:#141522;border-radius:6px;padding:6px;margin:4px 0;cursor:pointer}
#equip{position:absolute;bottom:100px;left:50%;transform:translateX(-50%);background:#0e0f16;color:#ffd166;border:2px solid #ffd166;border-radius:6px;padding:8px;display:none;min-width:420px}
.row{display:flex;gap:8px;flex-wrap:wrap}
.card{border:1px solid #30303f;background:#141522;border-radius:6px;padding:6px;color:#c9c9e0}
</style>
</head>
<body>
<div id="wrap">
  <canvas id="cv" width="860" height="640"></canvas>
  <div id="hud">
    <div>
      <div id="bossName">—</div>
      <div class="bar" style="width:320px"><div id="bossFill" class="fill"></div></div>
      <div id="bossVal">0/0</div>
    </div>
    <div style="text-align:right">
      <div>Player</div>
      <div class="bar" style="width:220px"><div id="hpFill" class="fill"></div></div>
      <div id="hpVal">60/60</div>
    </div>
  </div>
  <div id="bubble"></div>
  <div id="arena"></div>
  <div id="ui">
    <div class="btn" data-a="FIGHT">[Z] FIGHT</div>
    <div class="btn" data-a="ACT">[A] ACT</div>
    <div class="btn" data-a="MERCY">[M] MERCY</div>
    <div class="btn" data-a="EQUIP">[E] EQUIP</div>
    <div class="btn" data-a="SHOOT">[X] SHOOT</div>
  </div>
  <div id="act"><h3>ACT — <span id="actHint">0/4</span></h3><div id="actList"></div></div>
  <div id="equip"><h3>Equipment</h3>
    <div class="row">
      <div class="card" id="gear"></div>
      <div class="card" id="items"></div>
    </div>
    <div class="row">
      <button id="eqClose">Close</button>
    </div>
  </div>
</div>
<script>
"use strict";
/* Canvas & DOM */
const cv=document.getElementById("cv"),ctx=cv.getContext("2d");ctx.imageSmoothingEnabled=false;
const bossName=document.getElementById("bossName"),bossFill=document.getElementById("bossFill"),bossVal=document.getElementById("bossVal");
const hpFill=document.getElementById("hpFill"),hpVal=document.getElementById("hpVal");
const bubble=document.getElementById("bubble"),arena=document.getElementById("arena");
const ui=document.getElementById("ui"),actBox=document.getElementById("act"),actList=document.getElementById("actList"),actHint=document.getElementById("actHint");
const equipBox=document.getElementById("equip"),gearBox=document.getElementById("gear"),itemsBox=document.getElementById("items"),eqClose=document.getElementById("eqClose");
/* State */
let time=0,last=performance.now(),turn="player",showArena=false,acts=0;
let bullets=[],beam=[],held=new Set();
let SAVE=loadSave();
let HEART={x:430,y:460,r:6,sp:360,i:0,flash:0,hp:SAVE.hp||60,hpMax:SAVE.hpMax||60};
const WEAPONS={stick:{id:"stick",name:"Stick",atk:0},solar:{id:"solar",name:"Solar Brand",atk:7},frost:{id:"frost",name:"Frost Lance",atk:9},void:{id:"void",name:"Grav Halberd",atk:8}};
if(!SAVE.weapons) SAVE.weapons=["stick"]; if(!SAVE.currentWeapon) SAVE.currentWeapon="stick"; if(!SAVE.items) SAVE.items=[{id:"petal",name:"Petal",heal:12,count:2},{id:"elixir",name:"Elixir",heal:30,count:1}];
function eq(){return WEAPONS[SAVE.currentWeapon]||WEAPONS.stick;}
/* Bosses */
function B(id,name,hp,draw,bg,intro,lines,pat,tier){return{ id,name,hpMax:hp,hp:hp,draw,bg,intro,lines,pat,tier,offX:0,offY:0,moveT:0,
  actLines:{calm:["…hmm.","Soft, but felt."],taunt:["Bold tongue.","Heat rises."],gift:["Kindness? Noted."]},
  attackLines:["You dare.","Pain teaches.","Closer."], spareReq:4
};}
const BOSSES=[
  B("solar","Solar Fang",360,drawSolar,bgSolar,["The sun bows to no one.","Your shadow stretches long."],["Air shimmers.","Glare holds."],patSolar,1),
  B("ember","Ember Seraph",360,drawEmber,bgEmber,["Ash remembers flame.","Match breath with embers."],["Embers drift.","Kiln hums."],patEmber,2),
  B("frost","Frostbite Warden",380,drawFrost,bgFrost,["Cold clarifies.","Hold steady."],["Breath fogs.","No ripples."],patFrost,2),
  B("void","Void Prophet",420,drawVoid,bgVoid,["Gravity listens.","Choose your orbit."],["Fall inward.","Orbit forms."],patVoid,3)
];
let bi=SAVE.bi||0,BOSS=BOSSES[clamp(SAVE.bi||0,0,BOSSES.length-1)];
/* Helpers */
function clamp(v,a,b){return Math.max(a,Math.min(b,v));}
function say(t){bubble.style.display="block";bubble.textContent=BOSS.name+": "+t;}
function hideSay(){bubble.style.display="none";}
function updBars(){bossName.textContent=BOSS.name;bossFill.style.width=(320*(BOSS.hp/BOSS.hpMax))+"px";bossVal.textContent=`${Math.max(0,BOSS.hp)}/${BOSS.hpMax}`;hpFill.style.width=(220*(HEART.hp/HEART.hpMax))+"px";hpVal.textContent=`${Math.max(0,HEART.hp)}/${HEART.hpMax}`;}
function saveWrite(){localStorage.setItem("battle_compact_v1",JSON.stringify(SAVE));}
function loadSave(){try{return JSON.parse(localStorage.getItem("battle_compact_v1"))||{} }catch{return {} }}
function addItem(id,name,heal,count){const ex=SAVE.items.find(i=>i.id===id);if(ex) ex.count+=count; else SAVE.items.push({id,name,heal,count});}
function drawSoul(x,y){const g=ctx.createRadialGradient(x,y,2,x,y,14);g.addColorStop(0,"rgba(255,215,0,0.5)");g.addColorStop(1,"rgba(255,215,0,0)");ctx.fillStyle=g;ctx.beginPath();ctx.arc(x,y,14,0,7);ctx.fill();ctx.fillStyle=HEART.flash>0?"#fff":"#ffd700";ctx.beginPath();ctx.arc(x,y,HEART.r,0,7);ctx.fill();}
function drawBullets(){for(const b of bullets){ctx.fillStyle=b.col||"#fff";ctx.beginPath();ctx.arc(b.x,b.y,b.r||3,0,7);ctx.fill();}}
function drawBeams(){ctx.strokeStyle="rgba(255,214,102,0.9)";ctx.lineWidth=3;for(const s of beam){ctx.beginPath();ctx.moveTo(s.x1,s.y1);ctx.lineTo(s.x2,s.y2);ctx.stroke();}}
/* Backgrounds (compact & animated) */
function bgClear(){ctx.fillStyle="#0a0a0f";ctx.fillRect(0,0,860,640);}
function bgSolar(){bgClear();const g=ctx.createLinearGradient(0,0,0,640);g.addColorStop(0,"#ffe08a");g.addColorStop(1,"#ff9800");ctx.fillStyle=g;ctx.fillRect(0,0,860,640);ctx.strokeStyle="rgba(255,255,255,0.2)";for(let i=0;i<12;i++){const y=100+i*36,a=8+Math.sin(time*1.2+i)*4;ctx.beginPath();ctx.moveTo(0,y+a);ctx.lineTo(860,y-a);ctx.stroke();}for(let i=0;i<6;i++){const x=430+Math.sin(time*0.8+i)*220,y=320+Math.cos(time*1.0+i)*160;ctx.strokeStyle="rgba(255,255,255,0.2)";ctx.beginPath();ctx.arc(x,y,24+Math.sin(time*2+i)*6,0,7);ctx.stroke();}}
function bgEmber(){bgClear();const g=ctx.createLinearGradient(0,0,860,0);g.addColorStop(0,"#2b1a12");g.addColorStop(1,"#7a341c");ctx.fillStyle=g;ctx.fillRect(0,0,860,640);for(let i=0;i<140;i++){ctx.fillStyle=`rgba(255,160,120,${0.25+0.25*Math.sin(i+time)})`;ctx.fillRect((i*73+time*120)%860,(i*41+time*60)%640,2,6);}}
function bgFrost(){bgClear();const g=ctx.createLinearGradient(0,0,0,640);g.addColorStop(0,"#e8f7ff");g.addColorStop(1,"#aee3ff");ctx.fillStyle=g;ctx.fillRect(0,0,860,640);for(let i=0;i<120;i++){ctx.fillStyle=`rgba(255,255,255,${0.5+0.5*Math.sin(i+time)})`;ctx.fillRect((i*37+time*80)%860,(i*59+time*50)%640,3,3);}ctx.strokeStyle="rgba(255,255,255,0.16)";for(let i=0;i<10;i++){const y=100+i*60+Math.sin(time+i)*10;ctx.beginPath();ctx.moveTo(0,y);ctx.lineTo(860,y+Math.sin(time*2+i)*8);ctx.stroke();}}
function bgVoid(){bgClear();ctx.fillStyle="#0a0a16";ctx.fillRect(0,0,860,640);ctx.strokeStyle="rgba(200,185,255,0.18)";for(let r=60;r<=220;r+=22){ctx.beginPath();ctx.arc(430,320,r+Math.sin(time*1.4+r)*5,0,7);ctx.stroke();}for(let i=0;i<160;i++){const a=i/40*Math.PI*2+time*0.4,x=430+Math.cos(a)*220,y=320+Math.sin(a)*140;ctx.fillStyle=`rgba(210,200,255,${0.2+0.2*Math.sin(i+time)})`;ctx.fillRect(x,y,2,2);}}
function drawBG(){(BOSS.bg||bgClear)();}
/* Boss drawings */
function drawSolar(){const cx=430+(BOSS.offX||0),cy=260+(BOSS.offY||0)+Math.sin(time*1.8)*2;drawChar(cx,cy,"#ff9f40","#cc6600","#ffb347");}
function drawEmber(){const cx=430+(BOSS.offX||0),cy=260+(BOSS.offY||0);drawChar(cx,cy,"#8a4022","#ffa277","#ffbe8e");}
function drawFrost(){const cx=430+(BOSS.offX||0),cy=260+(BOSS.offY||0);drawChar(cx,cy,"#cfeeff","#aee3ff","#d8f4ff");}
function drawVoid(){const cx=430+(BOSS.offX||0),cy=260+(BOSS.offY||0);drawChar(cx,cy,"#3a2f66","#2f2858","#3e3571");ctx.strokeStyle="#c9b9ff";ctx.beginPath();ctx.arc(cx,cy-26,20+Math.sin(time*2)*2,0,7);ctx.stroke();}
function drawChar(cx,cy,h,b,a){ctx.fillStyle=h;ctx.beginPath();ctx.arc(cx,cy-26,15,0,7);ctx.fill();ctx.fillStyle=b;ctx.fillRect(cx-15,cy-12,30,52);ctx.fillStyle=a;ctx.fillRect(cx-29,cy-6,14,40);ctx.fillRect(cx+15,cy-6,14,40);}
/* Patterns */
function spawn(b){b.t=0;bullets.push(b);return b;}
function aimed(fx,fy,spd,col,r){const dx=HEART.x-fx,dy=HEART.y-fy,L=Math.hypot(dx,dy)||1;return spawn({x:fx,y:fy,vx:dx/L*spd,vy:dy/L*spd,col,r:r||3,s:true});}
function patSolar(){return[
  ph(3,(dt,t,acc)=>{acc.g=(acc.g||0)+dt;while(acc.g>=0.08){acc.g-=0.08;for(let i=0;i<14;i++){const x=190+(i+0.5)*(480/14);spawn({x,y:arenaTop()-10,vx:((i%2)?60:-60),vy:280,col:"#fff3b8",r:3,s:true});}}}),
  ph(3,(dt,t,acc)=>{acc.g=(acc.g||0)+dt;while(acc.g>=0.4){acc.g-=0.4;const cx=arenaMidX(),cy=arenaMidY();for(let k=0;k<20;k++){const a=k/20*Math.PI*2;spawn({x:cx,y:cy,vx:Math.cos(a)*300,vy:Math.sin(a)*300,col:"#ffd166",r:3,s:true});}}}),
  ph(3,(dt,t,acc)=>{acc.g=(acc.g||0)+dt;while(acc.g>=0.3){acc.g-=0.3;const x=arenaLeft()+arenaW()*(.2+.6*Math.random());aimed(x,arenaTop()-10,320,"#ffd166",3);}})
];}
function patEmber(){return[
  ph(3,(dt,t,a)=>{a.g=(a.g||0)+dt;while(a.g>=0.08){a.g-=0.08;for(let i=0;i<16;i++){const x=arenaLeft()+(i+0.5)*(arenaW()/16);spawn({x,y:arenaTop()-10,vx:((i%2)?50:-50),vy:300,col:"#ffb7a7",r:3,s:true});}}}),
  ph(3,(dt,t,a)=>{a.g=(a.g||0)+dt;while(a.g>=0.36){a.g-=0.36;const x=arenaLeft()+arenaW()*(.2+.6*Math.random());aimed(x,arenaTop()-10,320,"#ffd3a0",3);}})
];}
function patFrost(){return[
  ph(3,(dt,t,a)=>{a.g=(a.g||0)+dt;while(a.g>=0.08){a.g-=0.08;for(let i=0;i<16;i++){const x=arenaLeft()+(i+0.5)*(arenaW()/16);spawn({x,y:arenaTop()-10,vx:((i%2)?40:-40),vy:300,col:"#d0f0ff",r:3,s:true});}}}),
  ph(3,(dt,t,a)=>{a.g=(a.g||0)+dt;while(a.g>=0.38){a.g-=0.38;const cx=arenaMidX(),cy=arenaMidY();for(let k=0;k<22;k++){const a2=k/22*Math.PI*2;spawn({x:cx,y:cy,vx:Math.cos(a2)*300,vy:Math.sin(a2)*300,col:"#cfeeff",r:3,s:true});}}})
];}
function patVoid(){return[
  ph(3,(dt,t,a)=>{a.g=(a.g||0)+dt;while(a.g>=0.34){a.g-=0.34;const cx=arenaMidX(),cy=arenaMidY();for(let k=0;k<24;k++){const a2=k/24*Math.PI*2;spawn({x:cx,y:cy,vx:Math.cos(a2)*320,vy:Math.sin(a2)*320,col:"#d4c8ff",r:3,s:true});}}}),
  ph(3,(dt,t,a)=>{a.g=(a.g||0)+dt;while(a.g>=0.26){a.g-=0.26;const x=arenaLeft()+arenaW()*(.2+.6*Math.random());aimed(x,arenaTop()-10,320,"#cfc6ff",3);}})
];}
function ph(dur,fn){let t=0,acc={};return{enter(){t=0},update(dt){t+=dt;fn(dt,t,acc)},done(){return t>=dur}};}
/* Arena helpers */
function arenaLeft(){return 190}function arenaTop(){return 640-84-170}function arenaW(){return 480}function arenaH(){return 170}
function arenaMidX(){return arenaLeft()+arenaW()/2}function arenaMidY(){return arenaTop()+arenaH()/2}
/* Flow */
let atk=null,seq=null,ix=0;
function initBoss(i){bi=clamp(i,0,BOSSES.length-1);BOSS=BOSSES[bi];bossName.textContent=BOSS.name;seq=(BOSS.pat||patSolar)();ix=0;HEART.hp=HEART.hpMax;HEART.i=0;acts=0;updBars();turn="player";arena.style.display="none";hideSay();say(BOSS.intro.join(" "));SAVE.bi=bi;saveWrite();}
function startAtk(){bullets=[];beam=[];arena.style.display="block";showArena=true;hideSay();ui.style.opacity="0.7";atk=seq[ix];atk.enter&&atk.enter();ix=(ix+1)%seq.length;turn="enemy";}
function endAtk(){showArena=false;arena.style.display="none";ui.style.opacity="1";turn="player";say(randomPick(BOSS.lines));atk=null;}
function randomPick(a){return a[Math.floor(Math.random()*a.length)]||"...";}
/* ACT/MERCY */
const ACTS={
  solar:[{n:"Praise sunlight",d:"Respect the heat.",fn:()=>{acts=Math.min(BOSS.spareReq,acts+1);say("…hmm. ("+acts+"/4)")}}],
  ember:[{n:"Sing lullaby",d:"Cool the room.",fn:()=>{acts=Math.min(4,acts+1);say("Kiln calms. ("+acts+"/4)")}}],
  frost:[{n:"Hold still",d:"Respect the cold.",fn:()=>{acts=Math.min(4,acts+1);say("Clarity returns. ("+acts+"/4)")}}],
  void:[{n:"Choose orbit",d:"Commit to a path.",fn:()=>{acts=Math.min(4,acts+1);say("Orbit listens. ("+acts+"/4)")}}]
};
function openAct(){actBox.style.display="block";actList.innerHTML="";actHint.textContent=acts+"/4";(ACTS[BOSS.id]||[{n:"Stare",d:"...",fn:()=>{acts=Math.min(4,acts+1);say("… ("+acts+"/4)")}}]).forEach(a=>{const d=document.createElement("div");d.className="opt";d.innerHTML="<b>"+a.n+"</b><div style='font-size:12px;color:#c9c9e0'>"+a.d+"</div>";d.onclick=()=>{actBox.style.display="none";a.fn();setTimeout(startAtk,300)};actList.appendChild(d);});}
actBox.onclick=e=>{if(e.target.id==="act")actBox.style.display="none"}
/* Equip/heal (compact) */
function openEquip(){equipBox.style.display="block";gearBox.innerHTML="<b>Weapons</b><br>"+SAVE.weapons.map(wid=>{const w=WEAPONS[wid];return `<button data-w='${wid}'>${w.name}${SAVE.currentWeapon===wid?" (eq)":""}</button>`}).join(" ");itemsBox.innerHTML="<b>Items</b><br>"+SAVE.items.map((it,i)=>`<button data-i='${i}'>${it.name} (+${it.heal}) x${it.count}</button>`).join(" ");gearBox.querySelectorAll("button").forEach(b=>b.onclick=()=>{SAVE.currentWeapon=b.dataset.w;saveWrite();openEquip();});itemsBox.querySelectorAll("button").forEach(b=>b.onclick=()=>{const i=+b.dataset.i, it=SAVE.items[i]; if(!it||it.count<=0) return; it.count--; HEART.hp=Math.min(HEART.hpMax,HEART.hp+it.heal);updBars();saveWrite();openEquip();});}
eqClose.onclick=()=>equipBox.style.display="none";
/* Actions */
ui.onclick=e=>{const btn=e.target.closest(".btn");if(!btn)return;doAction(btn.dataset.a);}
document.addEventListener("keydown",e=>{
  if(turn==="player"){if(e.key==="z")doAction("FIGHT");if(e.key==="a")doAction("ACT");if(e.key==="m")doAction("MERCY");if(e.key==="e")doAction("EQUIP");}
  else{if(e.key==="ArrowLeft")held.add("l");if(e.key==="ArrowRight")held.add("r");if(e.key==="ArrowUp")held.add("u");if(e.key==="ArrowDown")held.add("d");if(e.key==="x")doAction("SHOOT");}
});
document.addEventListener("keyup",e=>{if(e.key==="ArrowLeft")held.delete("l");if(e.key==="ArrowRight")held.delete("r");if(e.key==="ArrowUp")held.delete("u");if(e.key==="ArrowDown")held.delete("d");});
function doAction(a){
  if(a==="ACT"){if(turn!=="player")return;openAct();return;}
  if(a==="MERCY"){if(turn!=="player")return;if(acts>=BOSS.spareReq){say("You spared "+BOSS.name);setTimeout(()=>nextBoss(),600);}else say("Not ready. ("+acts+"/4)");return;}
  if(a==="EQUIP"){openEquip();return;}
  if(a==="SHOOT"){if(turn!=="enemy")return;shootBeam();return;}
  if(a==="FIGHT"){if(turn!=="player")return;const w=eq();const dmg=24+w.atk;BOSS.hp=Math.max(0,BOSS.hp-dmg);updBars();if(BOSS.hp>0){say(randomPick(BOSS.attackLines));setTimeout(startAtk,200);}else{say("Defeated.");setTimeout(()=>nextBoss(),700);} }
}
function shootBeam(){const dir={x:0,y:-1};if(held.has("l")&&!held.has("r")){dir.x=-1;dir.y=0}else if(held.has("r")&&!held.has("l")){dir.x=1;dir.y=0}else if(held.has("d")&&!held.has("u")){dir.x=0;dir.y=1}
const x1=HEART.x,y1=HEART.y,x2=x1+dir.x*200,y2=y1+dir.y*200;beam.push({x1,y1,x2,y2,t:0});const w=6;bullets=bullets.filter(b=>{const vx=x2-x1,vy=y2-y1,wx=b.x-x1,wy=b.y-y1,c1=wx*vx+wy*vy,c2=vx*vx+vy*vy,u=c2>0?Math.max(0,Math.min(1,c1/c2)):0,px=x1+u*vx,py=y1+u*vy,dx=b.x-px,dy=b.y-py;return Math.hypot(dx,dy)>Math.max(w,(b.r||3)+2);});}
function nextBoss(){bi=(bi+1)%BOSSES.length;initBoss(bi);}
/* Movement & collide */
function move(dt){if(turn!=="enemy")return;let dx=(held.has("l")?-1:0)+(held.has("r")?1:0),dy=(held.has("u")?-1:0)+(held.has("d")?1:0),L=Math.hypot(dx,dy)||1;HEART.x=clamp(HEART.x+dx/L*HEART.sp*dt,arenaLeft()+HEART.r,arenaLeft()+arenaW()-HEART.r);HEART.y=clamp(HEART.y+dy/L*HEART.sp*dt,arenaTop()+HEART.r,arenaTop()+arenaH()-HEART.r);}
function stepBullets(dt){const s=1;for(const b of bullets){b.x+=b.vx*dt*s;b.y+=b.vy*dt*s;}const m=220;bullets=bullets.filter(b=>b.x>arenaLeft()-m&&b.x<arenaLeft()+arenaW()+m&&b.y>arenaTop()-m&&b.y<arenaTop()+arenaH()+m);}
function collide(){if(turn!=="enemy")return;if(HEART.i>0)return;for(const b of bullets){const dx=b.x-HEART.x,dy=b.y-HEART.y,r=(b.r||3)+HEART.r;if(dx*dx+dy*dy<=r*r){HEART.hp=Math.max(0,HEART.hp-14);HEART.i=0.75;HEART.flash=0.25;updBars();if(HEART.hp<=0){say("You fall.");setTimeout(()=>initBoss(bi),900);}break;}}}
/* Loop */
function render(){drawBG();BOSS.draw(time);if(showArena){ctx.strokeStyle="#fff";ctx.lineWidth=2;ctx.strokeRect(arenaLeft(),arenaTop(),arenaW(),arenaH());drawBullets();drawBeams();drawSoul(HEART.x,HEART.y);}}
function loop(now){const dt=Math.min(0.033,Math.max(0,(now-last)/1000));last=now;time+=dt;if(HEART.i>0)HEART.i=Math.max(0,HEART.i-dt);if(HEART.flash>0)HEART.flash=Math.max(0,HEART.flash-dt);
if(turn==="enemy"){ move(dt); atk&&atk.update(dt); stepBullets(dt); collide(); if(atk&&atk.done()) endAtk(); }
for(const s of beam){s.t+=dt}beam=beam.filter(s=>s.t<0.12);
render();requestAnimationFrame(loop);}
function buildAttack(){seq=(BOSS.pat||patSolar)();ix=0;}
/* Start */
function start(){buildAttack();initBoss(bi);updBars();requestAnimationFrame(loop);}
start();
/* Utility */
function drawCharLabel(x,y,t){ctx.fillStyle="#fff";ctx.fillText(t,x,y);}
function drawBossName(){ctx.fillStyle="#fff";ctx.fillText(BOSS.name,20,30);}
function drawBoss(time){BOSS.draw(time)}
/* End */
</script>
</body>
</html>
